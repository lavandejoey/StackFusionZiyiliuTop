extends layout

block content
    .container
        //- =====================
        //- 1) Users Table
        //- =====================
        .row.my-5
            .col
                .card.shadow-lg
                    .card-header.bg-gradient-primary.text-primary
                        h5.mb-0 User Statistics
                    .card-body
                        .table-responsive
                            table.table.table-hover.table-striped.align-middle
                                thead
                                    tr
                                        th User ID
                                        th Email
                                        th Name
                                        th Iter ID
                                        th Status
                                        th Created
                                        th Last Active
                                        th
                                tbody
                                    each user in userList
                                        tr
                                            td.user-select-all.text-monospace.text-truncate-8= user.uuid
                                            td.user-select-all= user.email
                                            td.text-monospace= `${user.first_name || ''} ${user.last_name || ''}`.trim()
                                            td= user.v2_iter_id || 'N/A'
                                            td
                                                span.badge(class=(user.status === "active" ? 'bg-success' : 'bg-danger'))= user.status
                                            - const formatDate = (date) => date ? new Date(date).toLocaleDateString() : 'N/A'
                                            td= formatDate(user.created_at)
                                            td= formatDate(user.updated_at)
                                            // Add a button for link + /:uuid to view in details
                                            td
                                                .btn.btn-primary.btn-sm(href=`/${user.uuid}`) #{__("View")}

        //- =====================
        //- 2) Visitors Analytics
        //- =====================
        .row.my-5
            .col
                .card.shadow-lg
                    .card-header.bg-gradient-info.text-secondary
                        .d-flex.justify-content-between.align-items-center
                            h5.mb-0 Visitor Analytics
                    .card-body
                        //- Row for search and select filters
                        .row.mb-3.d-flex.justify-content-evenly
                            .col-md-4
                                input.form-control(type="search", placeholder="Filter domain...", id="domainSearchInput")
                            .col-md-2
                                select.form-select.text-truncate#serverFilter
                                    option.text-truncate(value="all" selected) All Servers
                                    option(value="DE") DE
                                    option(value="US") US
                            // Compute default start date as 30 days before today
                            - const today = new Date();
                            - const todayStr = today.toISOString().split('T')[0];
                            - const startDate = new Date();
                            - startDate.setDate(startDate.getDate() - 30);
                            - const startDateStr = startDate.toISOString().split('T')[0];
                            .col-md-2
                                input.form-control(type="date", id="startDateFilter", value=startDateStr)
                            .col-md-2
                                input.form-control(type="date", id="endDateFilter", value=todayStr)
                        //- Row for the combined plot (canvas)
                        .row.mb-3
                            canvas#logs-plot.chart-container
                        //- Logs table
                        // forbid horizontal scrolling
                        .table-responsive(style="max-width: 100%;")
                            table.table.table-bordered.table-hover.table-sm#logs-table
                                thead
                                    tr
                                        th
                                            a.d-flex.justify-content-center.align-items-center#sortTimeBtn(href="javascript:void(0)")
                                                span Datetime&nbsp;
                                                i.bi.bi-arrow-down-up
                                        th
                                            a.d-flex.justify-content-center.align-items-center#sortEmailBtn(href="javascript:void(0)")
                                                span Email&nbsp;
                                                i.bi.bi-arrow-down-up
                                        th.text-center IP Address
                                        th.text-center Location
                                        th.text-center
                                            a.d-flex.justify-content-center.align-items-center#sortDomainBtn(href="javascript:void(0)")
                                                span Domain&nbsp;
                                                i.bi.bi-arrow-down-up
                                        th.text-center Server
                                tbody

    // Floating Back-to-Top button (using Font Awesome icon)
    button#backToTopBtn.btn.btn-primary.btn-lg(
        style="position: fixed; bottom: 80px; right: 80px; border-radius: 50%; display: none;")
        i.fas.fa-arrow-up

    style.
        .card {
            border-radius: 1rem;
            overflow: hidden;
        }

        .table {
            --bs-table-bg: null;
        }

        .table th, .table td {
            vertical-align: middle;

            a {
                color: inherit;
                text-decoration: none;

                &:hover {
                    cursor: pointer;
                    text-decoration: underline;
                }
            }
        }

        .form-control, .form-select {
            border: 1px solid #ccc;
            border-radius: 0.5rem;
        }

        .table tbody tr:hover {
            background-color: #f1f1f1;
        }

    script(src="/js/admin.js")

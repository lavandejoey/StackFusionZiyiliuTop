extends layout

block content
    .container
        //- =====================
        //- 1) Users Table
        //- =====================
        .row.my-5
            .col
                .card.shadow-lg
                    .card-header.bg-gradient-primary.text-primary
                        h5.mb-0 User Statistics
                    .card-body
                        .table-responsive
                            table.table.table-hover.table-striped.align-middle
                                thead
                                    tr
                                        th User ID
                                        th Email
                                        th Name
                                        th Iter ID
                                        th Status
                                        th Created
                                        th Last Active
                                tbody
                                    each user in userList
                                        tr
                                            td.text-monospace= user.uuid.substring(0, 8) + "..."
                                            td.user-select-all= user.email
                                            td= user.first_name + "" + user.last_name
                                            td= user.v2_iter_id
                                            td
                                                span.badge(class=(user.status === "active" ? `bg-success` : "bg-danger"))= user.status
                                            td= new Date(user.created_at).toLocaleDateString()
                                            td= new Date(user.updated_at).toLocaleDateString()

        //- =====================
        //- 2) Visitors Analytics
        //- =====================
        .row.my-5
            .col
                .card.shadow-lg
                    .card-header.bg-gradient-info.text-secondary
                        .d-flex.justify-content-between.align-items-center
                            h5.mb-0 Visitor Analytics
                            // Nav pills for different data sets
                            ul.nav.nav-pills#analyticsTabs
                                button.btn.btn-sm.btn-outline-dark.mx-2.active(data-bs-toggle="tab", data-bs-target="#all-tab") All
                                button.btn.btn-sm.btn-outline-dark.mx-2(data-bs-toggle="tab", data-bs-target="#de-tab") DE
                                button.btn.btn-sm.btn-outline-dark.mx-2(data-bs-toggle="tab", data-bs-target="#us-tab") US
                                button.btn.btn-sm.btn-outline-dark.mx-2(data-bs-toggle="tab", data-bs-target="#logs-tab") Logs

                    .card-body
                        .tab-content
                            //- All Servers
                            #all-tab.tab-pane.fade.show.active
                                .row.mb-3
                                    .col
                                        h6.text-muted All servers combined
                                .row
                                    //.col-md-12
                                    canvas#all-by-user.chart-container
                                    .container-fluid.d-flex.justify-content-between.align-items-center
                                        span.text-nowrap.mx-2#all-by-user-range-value
                                        input.form-range.mx-2(type="range", min="1", max="365", value="10", id="all-by-user-range")
                                //    .col-md-6
                                //        canvas#all-daily-by.chart-container
                                //.row.mt-3
                                //    .col-md-6
                                //        canvas#all-geo-chart.chart-container
                                //    .col-md-6
                                //        ul.list-group#all-geo-list(style="max-height: 300px; overflow-y: auto;")

                            //- DE
                            #de-tab.tab-pane.fade
                                .row.mb-3
                                    .col
                                        h6.text-muted DE server data
                                .row
                                    .col-md-6
                                        canvas#de-hourly-chart.chart-container
                                    .col-md-6
                                        canvas#de-daily-chart.chart-container
                                .row.mt-3
                                    .col-md-6
                                        canvas#de-geo-chart.chart-container
                                    .col-md-6
                                        ul.list-group#de-geo-list(style="max-height: 300px; overflow-y: auto;")

                            //- US
                            #us-tab.tab-pane.fade
                                .row.mb-3
                                    .col
                                        h6.text-muted US server data
                                .row
                                    .col-md-6
                                        canvas#us-hourly-chart.chart-container
                                    .col-md-6
                                        canvas#us-daily-chart.chart-container
                                .row.mt-3
                                    .col-md-6
                                        canvas#us-geo-chart.chart-container
                                    .col-md-6
                                        ul.list-group#us-geo-list(style="max-height: 300px; overflow-y: auto;")

                            //- Logs
                            #logs-tab.tab-pane.fade
                                .row.mb-3
                                    .col-md-4
                                        input.form-control(type="search", placeholder="Filter domain...", id="domainSearchInput")
                                    .col-md-3
                                        select.form-select.text-truncate#emailFilter
                                            option(value="all" selected) All emails
                                    .col-md-2
                                        select.form-select.text-truncate#serverFilter
                                            option(value="all" selected) All servers
                                            option(value="DE") DE
                                            option(value="US") US
                                .table-responsive
                                    table.table.table-bordered.table-hover.table-sm#logs-table
                                        thead
                                            tr
                                                th
                                                    a.d-flex.justify-content-center.align-items-center#sortTimeBtn(href="javascript:void(0)")
                                                        span Datetime&nbsp;
                                                        i.bi.bi-arrow-down-up
                                                th
                                                    a.d-flex.justify-content-center.align-items-center#sortEmailBtn(href="javascript:void(0)")
                                                        span Email&nbsp;
                                                        i.bi.bi-arrow-down-up
                                                th IP Address
                                                th Location
                                                th.text-center
                                                    a.d-flex.justify-content-center.align-items-center#sortDomainBtn(href="javascript:void(0)")
                                                        span Domain&nbsp;
                                                        i.bi.bi-arrow-down-up
                                                th Server
                                        tbody

    style.
        .card {
            border-radius: 1rem;
            overflow: hidden;
        }

        .table th, .table td {
            vertical-align: middle;

            & a {
                color: inherit;
                text-decoration: none;

                &:hover {
                    cursor: pointer;
                    text-decoration: underline;
                }
            }
        }

        .form-control, .form-select {
            border: 1px solid #ccc;
            border-radius: 0.5rem;
        }

        .table tbody tr:hover {
            background-color: #f1f1f1;
        }

    script(src="/js/admin.js")
    script.
        const deVisitLogData = !{JSON.stringify(deVisitLogData)};
        const usVisitLogData = !{JSON.stringify(usVisitLogData)};
        const allVisitLogData = !{JSON.stringify(allVisitLogData)};
extends layout

block content
    .container
        //- =====================
        //- 1) Users Table
        //- =====================
        .row.my-5
            .col
                .card.shadow-lg
                    .card-header.bg-gradient-primary.text-primary
                        h5.mb-0 User Statistics
                    .card-body
                        .table-responsive
                            table.table.table-hover.table-striped.align-middle
                                thead
                                    tr
                                        th User ID
                                        th Email
                                        th Name
                                        th Iter ID
                                        th Status
                                        th Created
                                        th Last Active
                                tbody
                                    each user in userList
                                        tr
                                            td.text-monospace= user.uuid.substring(0, 8) + "..."
                                            td.user-select-all= user.email
                                            td= user.first_name + " " + user.last_name
                                            td= user.v2_iter_id
                                            td
                                                span.badge(class=(user.status === "active" ? 'bg-success' : 'bg-danger'))= user.status
                                            td= new Date(user.created_at).toLocaleDateString()
                                            td= new Date(user.updated_at).toLocaleDateString()

        //- =====================
        //- 2) Visitors Analytics
        //- =====================
        .row.my-5
            .col
                .card.shadow-lg
                    .card-header.bg-gradient-info.text-secondary
                        .d-flex.justify-content-between.align-items-center
                            h5.mb-0 Visitor Analytics
                    .card-body
                        //- Row for search and select filters
                        .row.mb-3
                            .col-md-4
                                input.form-control(type="search", placeholder="Filter domain...", id="domainSearchInput")
                            .col-md-3
                                select.form-select.text-truncate#emailFilter
                                    option(value="all" selected) All emails
                            .col-md-2
                                select.form-select.text-truncate#serverFilter
                                    option(value="all" selected) All servers
                                    option(value="DE") DE
                                    option(value="US") US
                        //- New row for time period filter (start and end dates)
                        .row.mb-3
                            .col-md-3
                                -
                                // Compute default start date as 30 days before today
                                    const today = new Date();
                                    const todayStr = today.toISOString().split('T')[0];
                                    const startDate = new Date();
                                    startDate.setDate(startDate.getDate() - 30);
                                    const startDateStr = startDate.toISOString().split('T')[0];
                                input.form-control(type="date", id="startDateFilter", value=startDateStr)
                            .col-md-3
                                input.form-control(type="date", id="endDateFilter", value=todayStr)
                        //- Row for the combined plot (canvas)
                        .row.mb-3
                            canvas#all-by-user.chart-container
                        //- Logs table
                        .table-responsive
                            table.table.table-bordered.table-hover.table-sm#logs-table
                                thead
                                    tr
                                        th
                                            a.d-flex.justify-content-center.align-items-center#sortTimeBtn(href="javascript:void(0)")
                                                span Datetime&nbsp;
                                                i.bi.bi-arrow-down-up
                                        th
                                            a.d-flex.justify-content-center.align-items-center#sortEmailBtn(href="javascript:void(0)")
                                                span Email&nbsp;
                                                i.bi.bi-arrow-down-up
                                        th IP Address
                                        th Location
                                        th.text-center
                                            a.d-flex.justify-content-center.align-items-center#sortDomainBtn(href="javascript:void(0)")
                                                span Domain&nbsp;
                                                i.bi.bi-arrow-down-up
                                        th Server
                                tbody

    //- Floating Back-to-Top button (using Font Awesome icon)
    button#backToTopBtn.btn.btn-primary.btn-lg(
        style="position: fixed; bottom: 80px; right: 80px; border-radius: 50%; display: none;")
        i.fas.fa-arrow-up

    style.
        .card {
            border-radius: 1rem;
            overflow: hidden;
        }

        .table th, .table td {
            vertical-align: middle;

            a {
                color: inherit;
                text-decoration: none;

                &:hover {
                    cursor: pointer;
                    text-decoration: underline;
                }
            }
        }

        .form-control, .form-select {
            border: 1px solid #ccc;
            border-radius: 0.5rem;
        }

        .table tbody tr:hover {
            background-color: #f1f1f1;
        }

    script(src="/js/admin.js")
    script.
        const deVisitLogData = !{JSON.stringify(deVisitLogData)};
        const usVisitLogData = !{JSON.stringify(usVisitLogData)};
        const allVisitLogData = !{JSON.stringify(allVisitLogData)};

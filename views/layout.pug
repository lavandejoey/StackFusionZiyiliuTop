//- Define a mixin for displaying alerts
mixin alertMessage(type, message)
    if message
        .container.my-0
            .alert.alert-dismissible.fade.show(class="alert-" + type, role="alert")
                //- Display an icon depending on the alert type
                if type === "info"
                    i.fas.fa-info-circle.me-2(aria-hidden="true")
                else if type === "danger"
                    i.fas.fa-exclamation-triangle.me-2(aria-hidden="true")
                else if type === "success"
                    i.fas.fa-check-circle.me-2(aria-hidden="true")
                else if type === "warning"
                    i.fas.fa-exclamation-circle.me-2(aria-hidden="true")
                span= message
                //- Use Bootstrap 5 dismiss button markup
                button.btn-close(type="button", data-bs-dismiss="alert", aria-label="Close")

doctype html
html(lang=lang)
    head
        meta(charset="UTF-8")
        title=pageTitle
        // Language Alternates (for SEO with multiple languages)
        link(rel="alternate", hreflang="en", href="https://ziyiliu.top/")
        link(rel="alternate", hreflang="fr", href="https://ziyiliu.top/?lang=fr")
        link(rel="alternate", hreflang="zh-CN", href="https://ziyiliu.top/?lang=zh-CN")
        link(rel="alternate", hreflang="zh-HK", href="https://ziyiliu.top/?lang=zh-HK")
        // Favicon
        link(rel="icon", href="/images/favicon.ico", type="image/x-icon")
        // Meta viewport for responsive design
        meta(name="viewport", content="width=device-width, initial-scale=1.0")
        // SEO Meta Tags (add these)
        meta(name="description", content=pageDescription || 'Ziyi Liu - AI, Data Science, and Portfolio Site')
        meta(name="keywords", content="Ziyi Liu, Ziyi LIU, 刘子艺, 劉子藝, AI Researcher, Data Scientist, Computer Vision, Portfolio, Projects, Institut Polytechnique de Paris")
        // Open Graph Meta Tags (important for social sharing)
        meta(property="og:title", content=pageTitle)
        meta(property="og:description", content=pageDescription)
        meta(property="og:image", content=pageImage || "/images/logo-pic-bg.png")
        meta(property="og:url", content=currentUrl || "https://ziyiliu.top")
        meta(property="og:type", content="website")
        // Twitter Card Meta
        meta(name="twitter:card", content="summary_large_image")
        meta(name="twitter:title", content=pageTitle)
        meta(name="twitter:description", content=pageDescription)
        meta(name="twitter:image", content=pageImage || "/images/logo-pic-bg.png")
        // Fonts
        link(rel="preconnect", href="https://fonts.googleapis.com")
        link(rel="preconnect", href="https://fonts.gstatic.com", crossorigin)
        link(rel="stylesheet", href="https://fonts.googleapis.com/css2?family=Shantell+Sans:ital,wght@0,300..800;1,300..800&display=swap")
        // CSSs
        link(rel="stylesheet", href="/stylesheets/ziyiliu.min.css")
    body.bg-light.min-vh-100.d-flex.flex-column.p-4.m-sm-auto.p-sm-auto
        div.phoframe
        div.container-fluid.flex-grow-1(style="min-height: 100%; position: relative;display: flex; flex-direction: column;")
            // Navbar
            nav.navbar.navbar-expand-sm.navbar-light.bg-light#mainNavbar(style="z-index: 100;")
                div.container
                    button.navbar-toggler(type="button", data-bs-toggle="collapse", data-bs-target="#mainNavbarNav", aria-controls="navbarNav", aria-expanded="false", aria-label="Toggle navigation")
                        span.navbar-toggler-icon
                    #mainNavbarNav.collapse.navbar-collapse
                        ul.navbar-nav
                            li.nav-item.d-flex.justify-content-center
                                a.nav-link.main-navbar-item(href="/", class=(activePage === "Home" ? "active" : ""))
                                    span(class=(activePage === "Home" ? "underline" : "")) ZLiu"s
                            li.nav-item.d-flex.justify-content-center
                                a.nav-link.main-navbar-item(href="/about-me", class=(activePage === "About Me" ? "active" : ""))
                                    span(class=(activePage === "About Me" ? "underline" : "")) #{__("About Me")}
                            li.nav-item.d-flex.justify-content-center
                                a.nav-link.main-navbar-item(href="/contact", class=(activePage === "Contact" ? "active" : ""))
                                    span(class=(activePage === "Contact" ? "underline" : "")) #{__("Contact")}
                            li.nav-item.d-flex.justify-content-center
                                a.nav-link.main-navbar-item(href="/blog", class=(activePage === "Blog" ? "active" : ""))
                                    span(class=(activePage === "Blog" ? "underline" : "")) #{__("Blog")}
                        // Empty space to push language switcher to the right
                        div.ms-auto.d-flex.justify-content-center
                            if user && user.userId && user.userId !== ""
                                // profile button "/console/" + user.userId, method="get"
                                a.btn.btn-outline-primary.mx-auto.me-md-4(href="/console/" + user.userId)
                                    i.fas.fa-user
                                a.btn.btn-outline-danger.mx-auto.me-md-4(href="/auth/logout")
                                    i.fas.fa-sign-out-alt
                            div.dropdown.d-flex.justify-content-center.align-items-center.mx-auto(style="width: 100px")
                                button.btn.btn-outline-primary.no-caret.d-flex.align-items-center.justify-content-center(data-bs-toggle="dropdown" style="width: 100%; height: 100%;", aria-label="Language Switcher")
                                    i.fas.fa-language.fa-xl
                                ul.dropdown-menu(style="min-width: 0; width: auto; white-space: nowrap;")
                                    li
                                        a.dropdown-item.d-flex.justify-content-center(href="?lang=en")
                                            span English
                                    li
                                        a.dropdown-item.d-flex.justify-content-center(href="?lang=fr")
                                            span Français
                                    li
                                        a.dropdown-item.d-flex.justify-content-center(href="?lang=zh-CN")
                                            span 简体中文
                                    li
                                        a.dropdown-item.d-flex.justify-content-center(href="?lang=zh-HK")
                                            span 繁體中文
            if info
                +alertMessage("info", info)
            if error
                +alertMessage("danger", error)
            if success
                +alertMessage("success", success)
            if warning
                +alertMessage("warning", warning)
            // Main content
            block content
            // Centered Footer
            footer.w-100.d-flex.justify-content-center.py-3.mt-auto(style="color: gray; z-index: 100")
                div.text-center
                    p.mb-0
                        a(href="/auth/login", style="text-decoration: none; color: gray;")
                            | Copyright &#169; 2021-
                            span(id="current-year")
                        a(href="/", style="text-decoration: none; color: gray;")
                            |  #{__("Ziyi LIU")}
        // Floating info box for "Copied to Clipboard" message at horizontal center
        div#copyInfoBox.alert.alert-info.alert-dismissible.text-center.px-3.py-2(
            role="alert",
            style="position: fixed; bottom: 10%; left: 50%; transform: translateX(-50%); display: none;"
        ) #{__("Copied to clipboard!")}

    script(type="text/javascript").
        document.getElementById("current-year").textContent = new Date().getFullYear();

    // Include Bootstrap JS (via npm-installed file)
    script(type="module" src="/js/script.js")
    script(src="/bootstrap/dist/js/bootstrap.bundle.min.js")
    script(src="/jquery/dist/jquery.slim.js")
    //<script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    //<script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    script(src="/typewriter-effect/dist/core.js")
    script(src="/@fortawesome/fontawesome-free/js/all.min.js")
    script(src="/chart.js/dist/chart.umd.js")
    script(type="module").
        import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
        mermaid.initialize({startOnLoad: true});

    //<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css")
    style.
        .katex {
            font-size: 1em;
        }
    //<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script>
    script(defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js")
    //<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"></script>
    script(defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js")
    //script.
    //    document.addEventListener("DOMContentLoaded", function() {
    //        renderMathInElement(document.body);
    //    });
